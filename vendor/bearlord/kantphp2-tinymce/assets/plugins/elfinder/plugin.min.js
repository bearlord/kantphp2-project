tinymce.PluginManager.add("elfinder",
        function (editor) {

            function filemanager() {
                var t = window.innerWidth - 20,
                        i = window.innerHeight - 40;
                if (t > 1800 && (t = 1800), i > 1200 && (i = 1200), t > 600) {
                    var a = (t - 20) % 138;
                    t = t - a + 10;
                }
                editor.focus(!0);

                var title = "elFinder FileManager";
                if (typeof editor.settings.filemanager_title !== "undefined" && editor.settings.filemanager_title) {
                    title = editor.settings.filemanager_title;
                }

                win = editor.windowManager.open({
                    title: s,
                    file: e.settings.external_filemanager_path + "&type=4&descending=" + g + o + d + l + "&lang=" + e.settings.language + "&akey=" + r,
                    width: t,
                    height: i,
                    inline: 1,
                    resizable: !0,
                    maximizable: !0
                });
            }
            ;
            editor.addButton("elfinder", {
                icon: "browse",
                tooltip: "Insert file",
                shortcut: "Ctrl+E",
                onclick: filemanager
            });
            editor.addShortcut("Ctrl+E", "", filemanager);
            editor.addMenuItem("elfinder", {
                icon: "browse",
                text: "Insert file",
                shortcut: "Ctrl+E",
                onclick: filemanager,
                context: "insert"
            });
        });